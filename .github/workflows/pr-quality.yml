name: Pull Request Quality Check

on:
  pull_request:
    branches: [ main ]

jobs:
  pr-validation:
    name: PR Build and Validation
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout PR code
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: ðŸ“¦ Install dependencies
        run: |
          npm ci
          npm install -g @expo/cli

      - name: ðŸ” Quick lint check
        run: |
          echo "ðŸ” Running ESLint..."
          npx eslint . --ext .js,.jsx,.ts,.tsx || echo "âŒ Linting issues found"

      - name: ðŸ’… Format validation
        run: |
          echo "ðŸ’… Checking code formatting..."
          npx prettier --check "**/*.{js,jsx,ts,tsx,json,css,md}" || echo "âŒ Formatting issues found"

      - name: ðŸ§ª Run tests
        run: |
          echo "ðŸ§ª Running tests..."
          npm test -- --watchAll=false --passWithNoTests || echo "âŒ Test issues found"

      - name: ðŸ—ï¸ Build verification
        run: |
          echo "ðŸ—ï¸ Testing build process..."
          npm run build || echo "âŒ Build issues found"

      - name: ðŸ”’ Security check
        run: |
          echo "ðŸ”’ Running security audit..."
          npm audit --audit-level=high || echo "âš ï¸ Security issues found"

      - name: ðŸ“± Expo validation
        run: |
          echo "ðŸ“± Validating Expo configuration..."
          npx expo doctor || echo "âš ï¸ Expo configuration issues"

      - name: ðŸ“Š PR Summary
        if: always()
        run: |
          echo "## ðŸ“‹ PR Quality Check Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **Dependencies**: Installed successfully" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ” **Linting**: Checked" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ’… **Formatting**: Validated" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ§ª **Tests**: Executed" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ—ï¸ **Build**: Verified" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”’ **Security**: Audited" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“± **Expo**: Configuration checked" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸŽ‰ PR validation completed! Check individual steps for details." >> $GITHUB_STEP_SUMMARY
